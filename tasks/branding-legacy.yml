---
# Legacy console branding for OpenShift < 4.19
# Uses customLogoFile API (masthead logo only, no favicon support)

- name: Create console logo ConfigMap (legacy)
  kubernetes.core.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: ConfigMap
      metadata:
        name: console-custom-logo
        namespace: openshift-config
      data:
        console-logo.svg: |
          {{ lookup('file', role_path + '/files/console-logo.svg') | indent(10) }}
  ignore_errors: "{{ ansible_check_mode }}"

- name: Patch Console operator with custom branding (legacy)
  kubernetes.core.k8s:
    state: patched
    api_version: operator.openshift.io/v1
    kind: Console
    name: cluster
    definition:
      spec:
        customization:
          logos: null  # Clear modern field to avoid conflict
          customLogoFile:
            name: console-custom-logo
            key: console-logo.svg
          customProductName: "{{ crc_console_product_name }}"
  ignore_errors: "{{ ansible_check_mode }}"

- name: Display legacy branding notice
  ansible.builtin.debug:
    msg: "Applied legacy console branding (masthead only). Favicon requires OpenShift 4.19+."
